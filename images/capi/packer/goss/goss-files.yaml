file:
{{range $name, $vers := index .Vars .Vars.OS "common-files"}}
  {{ $name }}:
    exists: {{ $vers.exists }}
    filetype: {{ $vers.filetype }}
    contents: {{ range $vers.contents}}
    - {{.}}
  {{end}}
{{end}}
{{range $name, $vers := index .Vars .Vars.OS .Vars.PROVIDER "files"}}
  {{ $name }}:
    exists: {{ $vers.exists }}
    filetype: {{ $vers.filetype }}
    contents: {{ range $vers.contents}}
    - {{.}}
  {{end}}
{{end}}
{{if or (eq .Vars.OS "ubuntu") (eq .Vars.OS "photon")}}
{{if .Vars.node_custom_roles_pre | regexMatch ".*gpu.*"}}
  "/etc/modprobe.d/blocklist-nouveau.conf":
    exists: true
    filetype: file
    contents:
      - "blacklist nouveau"
      - "options nouveau modeset=0"
{{if eq .Vars.block_nouveau_loading "true"}}
      - "install nouveau /bin/false"
{{end}}
{{end}}
{{end}}
